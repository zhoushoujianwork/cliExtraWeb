# 🖥️ 实例状态管理功能

## 功能概述

实例状态管理功能为 cliExtraWeb 提供了实时的实例状态监控和可视化显示，让用户能够直观了解各实例的工作状态。

## 核心功能

### 1. 状态显示
- **idle（空闲）** - 绿色指示器 🟢
- **busy（忙碌）** - 黄色指示器 🟡  
- **waiting（等待）** - 蓝色指示器 🔵
- **error（错误）** - 红色指示器 🔴
- **stopped（已停止）** - 灰色指示器 ⚫

### 2. 实时更新
- 每30秒自动更新状态
- 状态变化时的视觉动画提示
- WebSocket 实时通信支持

### 3. 状态筛选
- 按状态类型筛选实例列表
- 状态统计概览显示
- 快速查看特定状态的实例

### 4. 详情面板
- 点击状态指示器查看详细信息
- 显示进程PID、运行时间、最后活动时间
- 最近输出内容预览

## 技术实现

### 后端API
```python
# 获取所有实例状态
GET /api/instances/status

# 获取单个实例详细状态  
GET /api/instances/<instance_name>/status
```

### 前端组件
- `instance-status.js` - 状态管理核心逻辑
- `instance-status.css` - 状态显示样式
- 自动初始化和生命周期管理

### 状态判断逻辑
基于实例输出内容分析：
- 检查等待输入关键词
- 识别错误信息
- 判断处理状态
- 默认空闲状态

## 使用方法

### 1. 查看状态
实例列表中每个实例名称后会显示彩色状态指示器

### 2. 筛选实例
使用页面顶部的状态筛选下拉框

### 3. 查看详情
点击状态指示器打开详情模态框

### 4. 实时监控
状态会自动更新，无需手动刷新

## 配置选项

### 更新频率
```javascript
// 默认30秒，可在 instance-status.js 中修改
this.statusUpdateInterval = setInterval(() => {
    this.updateAllInstancesStatus();
}, 30000);
```

### 状态颜色
```javascript
// 在 setupStatusColors() 方法中自定义
this.statusColors = {
    'idle': { color: '#28a745', bg: '#d4edda', text: '空闲' },
    'busy': { color: '#ffc107', bg: '#fff3cd', text: '忙碌' },
    // ...
};
```

## 测试验证

### 测试页面
```bash
# 打开测试页面
open test/instance_status_test.html
```

### 功能测试
1. ✅ 状态指示器显示
2. ✅ 状态筛选功能
3. ✅ 详情模态框
4. ✅ 实时更新机制
5. ✅ 响应式设计

## 故障排除

### 状态不更新
- 检查 `/api/instances/status` API 是否正常
- 确认 JavaScript 控制台无错误
- 验证实例管理器状态检查逻辑

### 样式显示异常
- 确认 `instance-status.css` 已正确加载
- 检查 Bootstrap 版本兼容性
- 验证 CSS 选择器是否正确

### 详情模态框无法打开
- 确认 Bootstrap JavaScript 已加载
- 检查模态框 HTML 结构
- 验证事件绑定是否正确

## 扩展建议

### 1. 状态历史
记录状态变化历史，提供趋势分析

### 2. 告警通知
状态异常时的桌面通知或邮件告警

### 3. 性能指标
添加CPU、内存使用率等性能指标

### 4. 自定义状态
允许用户定义自定义状态类型

## 更新日志

### v1.0.0 (2024-07-24)
- ✅ 基础状态显示功能
- ✅ 实时状态更新
- ✅ 状态筛选和统计
- ✅ 详情模态框
- ✅ 响应式设计支持
