# ç»ˆç«¯æ»šåŠ¨åŠ è½½åŠŸèƒ½

## åŠŸèƒ½æ¦‚è¿°

ç»ˆç«¯æ»šåŠ¨åŠ è½½åŠŸèƒ½å…è®¸ç”¨æˆ·åœ¨Webç•Œé¢ä¸­æ»šåŠ¨æŸ¥çœ‹å®Œæ•´çš„ç»ˆç«¯å†å²è®°å½•ï¼Œæ”¯æŒæŒ‰éœ€åŠ è½½å¤§æ–‡ä»¶å†…å®¹ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

### 1. æ™ºèƒ½åˆ†é¡µåŠ è½½
- **æŒ‰éœ€åŠ è½½**: åªåŠ è½½ç”¨æˆ·å½“å‰æŸ¥çœ‹çš„å†…å®¹
- **æ™ºèƒ½åˆ†é¡µ**: æ ¹æ®æ–‡ä»¶å¤§å°è‡ªåŠ¨è°ƒæ•´é¡µå¤§å°
- **åŒå‘æ»šåŠ¨**: æ”¯æŒå‘ä¸Šå’Œå‘ä¸‹æ»šåŠ¨åŠ è½½

### 2. æ»šåŠ¨äº¤äº’
- **è‡ªåŠ¨è§¦å‘**: æ»šåŠ¨åˆ°é¡¶éƒ¨æ—¶è‡ªåŠ¨åŠ è½½æ›´å¤šå†å²è®°å½•
- **å¹³æ»‘ä½“éªŒ**: ä¿æŒæ»šåŠ¨ä½ç½®ï¼Œé¿å…è·³è·ƒ
- **åŠ è½½æç¤º**: æ˜¾ç¤ºåŠ è½½çŠ¶æ€å’Œè¿›åº¦

### 3. å†…å®¹æœç´¢
- **å¿«é€Ÿæœç´¢**: åœ¨æ•´ä¸ªæ–‡ä»¶ä¸­æœç´¢å…³é”®è¯
- **é«˜äº®æ˜¾ç¤º**: æœç´¢ç»“æœé«˜äº®æ˜¾ç¤ºåŒ¹é…å†…å®¹
- **ç²¾ç¡®å®šä½**: ç‚¹å‡»æœç´¢ç»“æœè·³è½¬åˆ°å¯¹åº”è¡Œ

### 4. ç”¨æˆ·ç•Œé¢
- **è¡Œå·æ˜¾ç¤º**: æ¯è¡Œæ˜¾ç¤ºå¯¹åº”çš„è¡Œå·
- **çŠ¶æ€ä¿¡æ¯**: æ˜¾ç¤ºå½“å‰åŠ è½½è¿›åº¦å’Œæ€»è¡Œæ•°
- **å“åº”å¼è®¾è®¡**: é€‚é…å„ç§å±å¹•å°ºå¯¸

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### åç«¯API

#### 1. è·å–å†å²ä¿¡æ¯
```http
GET /api/terminal/history/{instance_id}
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "total_lines": 5000,
  "file_size": 1048576,
  "last_modified": 1753349003.201,
  "file_path": "/path/to/log/file",
  "recommended_page_size": 100
}
```

#### 2. åˆ†é¡µè·å–è¾“å‡º
```http
GET /api/terminal/output/{instance_id}?page=1&page_size=100&direction=backward&from_line=5000
```

**å‚æ•°è¯´æ˜**:
- `page`: é¡µç ï¼ˆä»1å¼€å§‹ï¼‰
- `page_size`: æ¯é¡µè¡Œæ•°ï¼ˆå»ºè®®50-200ï¼‰
- `direction`: æ–¹å‘ï¼ˆ`forward`/`backward`ï¼‰
- `from_line`: èµ·å§‹è¡Œå·

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "lines": [
    {
      "line_number": 4901,
      "content": "2025-01-24 17:30:00 - INFO - åº”ç”¨å¯åŠ¨æˆåŠŸ",
      "timestamp": 1753349000.0,
      "type": "output"
    }
  ],
  "total_lines": 5000,
  "current_page": 1,
  "page_size": 100,
  "start_line": 4901,
  "end_line": 5000,
  "has_more": false,
  "has_previous": true,
  "direction": "backward"
}
```

#### 3. æœç´¢å†…å®¹
```http
GET /api/terminal/search/{instance_id}?q=error&max_results=50
```

**å“åº”ç¤ºä¾‹**:
```json
{
  "success": true,
  "query": "error",
  "results": [
    {
      "line_number": 1234,
      "content": "2025-01-24 17:25:00 - ERROR - è¿æ¥å¤±è´¥",
      "match_positions": [
        {"start": 25, "end": 30}
      ]
    }
  ],
  "total_matches": 15,
  "max_results": 50,
  "has_more": false
}
```

### å‰ç«¯å®ç°

#### JavaScriptç±»ç»“æ„
```javascript
class TerminalScrollLoader {
    constructor(terminalContainer, instanceId)
    
    // æ ¸å¿ƒæ–¹æ³•
    async init()                    // åˆå§‹åŒ–
    async loadLatestContent()       // åŠ è½½æœ€æ–°å†…å®¹
    async loadMoreHistory()         // åŠ è½½å†å²è®°å½•
    setupScrollListener()           // è®¾ç½®æ»šåŠ¨ç›‘å¬
    
    // æ¸²æŸ“æ–¹æ³•
    renderLines()                   // æ¸²æŸ“æ‰€æœ‰è¡Œ
    createLineElement(line)         // åˆ›å»ºè¡Œå…ƒç´ 
    createLoadMoreButton()          // åˆ›å»ºåŠ è½½æ›´å¤šæŒ‰é’®
    
    // æœç´¢åŠŸèƒ½
    async searchContent(query)      // æœç´¢å†…å®¹
    showSearchResults(data)         // æ˜¾ç¤ºæœç´¢ç»“æœ
    jumpToLine(lineNumber)          // è·³è½¬åˆ°æŒ‡å®šè¡Œ
}
```

#### CSSæ ·å¼ç‰¹æ€§
- **ç»ˆç«¯ä¸»é¢˜**: æ·±è‰²èƒŒæ™¯ï¼Œç­‰å®½å­—ä½“
- **æ»šåŠ¨æ¡ç¾åŒ–**: è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼
- **é«˜äº®æ•ˆæœ**: æœç´¢ç»“æœå’Œè·³è½¬è¡Œé«˜äº®
- **å“åº”å¼å¸ƒå±€**: ç§»åŠ¨ç«¯é€‚é…

## ğŸ“± ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬æ“ä½œ

1. **é€‰æ‹©å®ä¾‹**: ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©è¦æŸ¥çœ‹çš„å®ä¾‹
2. **åŠ è½½ç»ˆç«¯**: ç‚¹å‡»"åŠ è½½ç»ˆç«¯"æŒ‰é’®åˆå§‹åŒ–
3. **æŸ¥çœ‹å†å²**: å‘ä¸Šæ»šåŠ¨è‡ªåŠ¨åŠ è½½æ›´å¤šå†å²è®°å½•
4. **æœç´¢å†…å®¹**: è¾“å…¥å…³é”®è¯æœç´¢ç‰¹å®šå†…å®¹

### é«˜çº§åŠŸèƒ½

#### æ»šåŠ¨åŠ è½½
```javascript
// åˆå§‹åŒ–æ»šåŠ¨åŠ è½½å™¨
const loader = initTerminalScrollLoader('terminal-container', 'instance_id');

// æ‰‹åŠ¨åŠ è½½æ›´å¤šå†å²
await loader.loadMoreHistory();

// è·³è½¬åˆ°åº•éƒ¨
loader.scrollToBottom();
```

#### æœç´¢åŠŸèƒ½
```javascript
// æœç´¢å†…å®¹
await loader.searchContent('error');

// è·³è½¬åˆ°æŒ‡å®šè¡Œ
loader.jumpToLine(1234);
```

## ğŸ¯ æ€§èƒ½ä¼˜åŒ–

### 1. åˆ†é¡µç­–ç•¥
- **æ™ºèƒ½é¡µå¤§å°**: æ ¹æ®æ–‡ä»¶å¤§å°åŠ¨æ€è°ƒæ•´
- **ç¼“å­˜æœºåˆ¶**: å·²åŠ è½½çš„å†…å®¹ä¿å­˜åœ¨å†…å­˜ä¸­
- **æ‡’åŠ è½½**: åªåœ¨éœ€è¦æ—¶åŠ è½½å†…å®¹

### 2. æ»šåŠ¨ä¼˜åŒ–
- **é˜²æŠ–å¤„ç†**: é¿å…é¢‘ç¹è§¦å‘åŠ è½½
- **ä½ç½®ä¿æŒ**: åŠ è½½æ–°å†…å®¹æ—¶ä¿æŒæ»šåŠ¨ä½ç½®
- **å¹³æ»‘æ»šåŠ¨**: ä½¿ç”¨CSSåŠ¨ç”»æå‡ä½“éªŒ

### 3. å†…å­˜ç®¡ç†
- **è¡Œæ•°é™åˆ¶**: é¿å…åŠ è½½è¿‡å¤šå†…å®¹åˆ°å†…å­˜
- **åƒåœ¾å›æ”¶**: åŠæ—¶æ¸…ç†ä¸éœ€è¦çš„DOMå…ƒç´ 
- **åˆ†å—å¤„ç†**: å¤§æ–‡ä»¶åˆ†å—å¤„ç†

## ğŸ”§ é…ç½®é€‰é¡¹

### é»˜è®¤é…ç½®
```javascript
const config = {
    pageSize: 100,           // æ¯é¡µè¡Œæ•°
    maxLines: 10000,         // æœ€å¤§åŠ è½½è¡Œæ•°
    scrollThreshold: 100,    // æ»šåŠ¨è§¦å‘é˜ˆå€¼ï¼ˆåƒç´ ï¼‰
    searchMaxResults: 50,    // æœç´¢æœ€å¤§ç»“æœæ•°
    debounceDelay: 150      // é˜²æŠ–å»¶è¿Ÿï¼ˆæ¯«ç§’ï¼‰
};
```

### è‡ªå®šä¹‰é…ç½®
```javascript
// åˆ›å»ºè‡ªå®šä¹‰é…ç½®çš„åŠ è½½å™¨
const loader = new TerminalScrollLoader(container, instanceId);
loader.pageSize = 200;
loader.scrollThreshold = 50;
```

## ğŸ“Š ä½¿ç”¨åœºæ™¯

### 1. æ—¥å¿—åˆ†æ
- **é”™è¯¯æ’æŸ¥**: å¿«é€Ÿæœç´¢é”™è¯¯ä¿¡æ¯
- **æ€§èƒ½åˆ†æ**: æŸ¥çœ‹åº”ç”¨æ€§èƒ½æ—¥å¿—
- **è°ƒè¯•ä¿¡æ¯**: æµè§ˆè¯¦ç»†çš„è°ƒè¯•è¾“å‡º

### 2. å®æ—¶ç›‘æ§
- **çŠ¶æ€ç›‘æ§**: æŸ¥çœ‹å®ä¾‹è¿è¡ŒçŠ¶æ€
- **äº‹ä»¶è¿½è¸ª**: è·Ÿè¸ªç‰¹å®šäº‹ä»¶çš„å‘ç”Ÿ
- **å†å²å›é¡¾**: å›é¡¾å†å²è¿è¡Œæƒ…å†µ

### 3. å¼€å‘è°ƒè¯•
- **ä»£ç è°ƒè¯•**: æŸ¥çœ‹ç¨‹åºè¾“å‡º
- **æµ‹è¯•éªŒè¯**: éªŒè¯åŠŸèƒ½æ˜¯å¦æ­£å¸¸
- **é—®é¢˜å®šä½**: å¿«é€Ÿå®šä½é—®é¢˜æ‰€åœ¨

## ğŸš€ éƒ¨ç½²å’Œé›†æˆ

### 1. æ–‡ä»¶ç»“æ„
```
app/
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â””â”€â”€ terminal_scroll_loader.js
â”‚   â””â”€â”€ css/
â”‚       â””â”€â”€ terminal_scroll.css
â”œâ”€â”€ templates/
â”‚   â””â”€â”€ terminal_scroll_demo.html
â”œâ”€â”€ views/
â”‚   â””â”€â”€ terminal_api.py
â””â”€â”€ services/
    â””â”€â”€ instance_manager.py (å¢å¼º)
```

### 2. ä¾èµ–è¦æ±‚
- **åç«¯**: Flask, Python 3.7+
- **å‰ç«¯**: ç°ä»£æµè§ˆå™¨ï¼ˆæ”¯æŒES6+ï¼‰
- **å¯é€‰**: Bootstrap 5ï¼ˆç”¨äºæ ·å¼ï¼‰

### 3. é›†æˆæ­¥éª¤
1. å¤åˆ¶ç›¸å…³æ–‡ä»¶åˆ°é¡¹ç›®ä¸­
2. åœ¨ä¸»æ¨¡æ¿ä¸­å¼•å…¥CSSå’ŒJSæ–‡ä»¶
3. æ·»åŠ APIè·¯ç”±åˆ°Flaskåº”ç”¨
4. åˆå§‹åŒ–æ»šåŠ¨åŠ è½½å™¨

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨
**é—®é¢˜**: APIè¿”å›"æ—¥å¿—æ–‡ä»¶ä¸å­˜åœ¨"
**è§£å†³**: ç¡®ä¿å®ä¾‹æ­£åœ¨è¿è¡Œä¸”æœ‰æ—¥å¿—è¾“å‡º

#### 2. åŠ è½½ç¼“æ…¢
**é—®é¢˜**: å¤§æ–‡ä»¶åŠ è½½ç¼“æ…¢
**è§£å†³**: è°ƒæ•´é¡µå¤§å°ï¼Œä½¿ç”¨æ›´å°çš„åˆ†é¡µ

#### 3. æœç´¢æ— ç»“æœ
**é—®é¢˜**: æœç´¢ä¸åˆ°é¢„æœŸå†…å®¹
**è§£å†³**: æ£€æŸ¥æœç´¢å…³é”®è¯ï¼Œç¡®è®¤æ–‡ä»¶å†…å®¹

### è°ƒè¯•æ–¹æ³•

#### 1. å¼€å¯è°ƒè¯•æ—¥å¿—
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­å¼€å¯è¯¦ç»†æ—¥å¿—
localStorage.setItem('terminal_debug', 'true');
```

#### 2. æ£€æŸ¥APIå“åº”
```bash
# æµ‹è¯•APIç«¯ç‚¹
curl "http://localhost:5001/api/terminal/history/instance_id"
curl "http://localhost:5001/api/terminal/output/instance_id?page=1&page_size=10"
```

#### 3. éªŒè¯æ–‡ä»¶æƒé™
```bash
# æ£€æŸ¥æ—¥å¿—æ–‡ä»¶æ˜¯å¦å­˜åœ¨å’Œå¯è¯»
ls -la ~/Library/Application\ Support/cliExtra/namespaces/*/logs/
```

## ğŸ“ˆ æœªæ¥æ‰©å±•

### è®¡åˆ’åŠŸèƒ½
1. **å®æ—¶æ›´æ–°**: WebSocketå®æ—¶æ¨é€æ–°å†…å®¹
2. **å¤šæ–‡ä»¶æ”¯æŒ**: åŒæ—¶æŸ¥çœ‹å¤šä¸ªæ—¥å¿—æ–‡ä»¶
3. **å¯¼å‡ºåŠŸèƒ½**: å¯¼å‡ºæœç´¢ç»“æœæˆ–é€‰å®šå†…å®¹
4. **è¿‡æ»¤å™¨**: æŒ‰æ—¥æœŸã€çº§åˆ«ç­‰è¿‡æ»¤å†…å®¹
5. **ä¹¦ç­¾åŠŸèƒ½**: æ ‡è®°é‡è¦çš„è¡Œæˆ–ä½ç½®

### æ€§èƒ½æ”¹è¿›
1. **è™šæ‹Ÿæ»šåŠ¨**: å¤„ç†è¶…å¤§æ–‡ä»¶çš„è™šæ‹Ÿæ»šåŠ¨
2. **ç´¢å¼•ä¼˜åŒ–**: å»ºç«‹å†…å®¹ç´¢å¼•åŠ é€Ÿæœç´¢
3. **å‹ç¼©ä¼ è¾“**: å‹ç¼©APIå“åº”å‡å°‘ä¼ è¾“é‡
4. **ç¼“å­˜ç­–ç•¥**: æ›´æ™ºèƒ½çš„å®¢æˆ·ç«¯ç¼“å­˜

---

**å¼€å‘å®Œæˆ**: 2025-01-24  
**ç‰ˆæœ¬**: v1.0.0  
**å…¼å®¹æ€§**: cliExtraWeb v1.3+
