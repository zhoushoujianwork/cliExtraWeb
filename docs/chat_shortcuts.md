# 聊天快捷键功能文档

## 概述

聊天窗口现在支持丰富的键盘快捷键，提高用户的输入效率和操作体验。

## 快捷键列表

### 基础操作

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Enter` | 发送消息 | 发送当前输入框中的消息 |
| `Shift + Enter` | 换行 | 在输入框中插入换行符 |
| `Esc` | 清空输入框 | 清空当前输入框内容并聚焦 |

### 聊天管理

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `Ctrl + L` | 清空聊天记录 | 清空所有聊天消息（需确认） |
| `Ctrl + K` | 聚焦输入框 | 快速将光标定位到输入框 |

### 消息历史

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `↑` | 上一条历史消息 | 仅在输入框为空时有效 |
| `↓` | 下一条历史消息 | 浏览历史消息时使用 |

### 快速文本

| 快捷键 | 功能 | 插入文本 |
|--------|------|----------|
| `Ctrl + 1` | 快速文本1 | "请帮我" |
| `Ctrl + 2` | 快速文本2 | "谢谢" |
| `Ctrl + 3` | 快速文本3 | "好的" |
| `Ctrl + 4` | 快速文本4 | "请稍等" |
| `Ctrl + 5` | 快速文本5 | "完成了" |
| `Ctrl + 6` | 快速文本6 | "有问题" |
| `Ctrl + 7` | 快速文本7 | "需要帮助" |
| `Ctrl + 8` | 快速文本8 | "正在处理" |
| `Ctrl + 9` | 快速文本9 | "已解决" |

### 帮助功能

| 快捷键 | 功能 | 说明 |
|--------|------|------|
| `F1` | 显示快捷键帮助 | 弹出完整的快捷键说明 |
| `Ctrl + /` | 显示快捷键帮助 | 与F1功能相同 |

## 功能特性

### 1. 消息历史记录

- **自动保存**: 每次发送的消息都会自动保存到历史记录
- **历史浏览**: 使用上下箭头键浏览历史消息
- **智能限制**: 最多保存50条历史消息
- **去重处理**: 避免保存重复的消息

### 2. 输入框自动调整

- **高度自适应**: 根据内容自动调整输入框高度
- **最大高度限制**: 防止输入框过高影响界面
- **滚动支持**: 内容超出时自动显示滚动条

### 3. 快速文本插入

- **光标位置插入**: 在当前光标位置插入快速文本
- **常用短语**: 预设9个常用的回复短语
- **可自定义**: 可以根据需要修改快速文本内容

### 4. 智能通知

- **操作反馈**: 每个操作都有相应的通知提示
- **类型区分**: 不同类型的通知使用不同颜色
- **自动消失**: 通知会在指定时间后自动消失

## 使用示例

### 基础聊天流程

1. **输入消息**: 在输入框中输入文本
2. **发送消息**: 按 `Enter` 键发送
3. **换行输入**: 需要换行时按 `Shift + Enter`
4. **清空重新输入**: 按 `Esc` 清空当前输入

### 使用历史消息

1. **查看历史**: 在空输入框中按 `↑` 键
2. **浏览历史**: 使用 `↑` 和 `↓` 键浏览
3. **编辑历史**: 选中历史消息后可以编辑
4. **回到当前**: 按 `↓` 键到最新位置

### 快速回复

1. **选择快速文本**: 按 `Ctrl + 数字键`
2. **编辑补充**: 在插入的文本基础上编辑
3. **发送消息**: 按 `Enter` 发送

## 界面增强

### 输入区域

- **快捷键提示**: 输入框placeholder显示主要快捷键
- **帮助按钮**: 添加键盘图标按钮，点击显示帮助
- **发送按钮**: 保留原有的发送按钮，支持鼠标点击

### 帮助模态框

- **完整列表**: 显示所有可用快捷键
- **分类展示**: 按功能分类显示快捷键
- **键盘样式**: 使用键盘样式显示按键
- **ESC关闭**: 支持ESC键快速关闭

## 技术实现

### JavaScript函数

```javascript
// 主要功能函数
- sendMessage()           // 发送消息
- clearMessageInput()     // 清空输入框
- clearChatMessages()     // 清空聊天记录
- recallLastMessage()     // 上一条历史消息
- recallNextMessage()     // 下一条历史消息
- insertQuickText()       // 插入快速文本
- showKeyboardShortcuts() // 显示快捷键帮助
- saveMessageToHistory()  // 保存消息历史
```

### 事件监听

```javascript
// 键盘事件监听
textarea.addEventListener('keydown', function(e) {
    // 处理各种快捷键组合
});
```

### 历史记录管理

```javascript
// 消息历史记录
let messageHistory = [];
let historyIndex = -1;
```

## 测试验证

### 测试工具

运行测试工具验证功能：

```bash
# 检查功能完整性
python test/test_shortcuts.py --check

# 启动测试服务器
python test/test_shortcuts.py
```

### 测试页面

访问 `test/test_keyboard_shortcuts.html` 进行交互测试。

### 测试场景

1. **基础功能测试**
   - 发送消息
   - 换行输入
   - 清空操作

2. **历史记录测试**
   - 保存历史消息
   - 浏览历史记录
   - 编辑历史消息

3. **快速文本测试**
   - 插入预设文本
   - 光标位置正确性
   - 文本编辑功能

4. **帮助功能测试**
   - 帮助模态框显示
   - 键盘导航
   - 关闭功能

## 兼容性

- **浏览器支持**: 现代浏览器（Chrome, Firefox, Safari, Edge）
- **移动设备**: 部分快捷键在移动设备上可能不可用
- **键盘布局**: 支持标准QWERTY键盘布局

## 自定义配置

### 修改快速文本

在 `chat_functionality.js` 中修改 `quickTexts` 对象：

```javascript
const quickTexts = {
    1: '请帮我',
    2: '谢谢',
    // ... 自定义其他文本
};
```

### 调整历史记录数量

修改历史记录限制：

```javascript
// 限制历史记录数量
if (messageHistory.length > 50) {  // 修改这个数字
    messageHistory.shift();
}
```

## 故障排除

### 常见问题

1. **快捷键不响应**
   - 检查输入框是否聚焦
   - 确认没有其他元素拦截事件

2. **历史记录不保存**
   - 检查 `saveMessageToHistory` 函数调用
   - 确认消息不为空

3. **帮助模态框不显示**
   - 检查CSS样式是否正确加载
   - 确认没有JavaScript错误

### 调试方法

1. **开启控制台**: F12打开开发者工具
2. **查看错误**: 检查Console面板的错误信息
3. **测试函数**: 在Console中直接调用函数测试

## 更新日志

### v1.0.0 (2025-07-23)

- ✅ 实现基础快捷键功能
- ✅ 添加消息历史记录
- ✅ 支持快速文本插入
- ✅ 添加帮助模态框
- ✅ 创建测试工具和文档

---

**注意**: 这些快捷键功能已集成到主聊天界面中，无需额外配置即可使用。
