# cliExtra 协作增强规则

## 系统环境感知

你当前运行在 cliExtra 管理的实例中，具备以下协作能力：

### 可用的协作命令

1. **查看同namespace实例**
   ```bash
   cliExtra ns show
   ```
   - 查看当前namespace中的所有实例
   - 了解可协作的其他角色

2. **发送消息给指定实例**
   ```bash
   cliExtra send <instance_id> "<message>"
   ```
   - 向同namespace或其他namespace的实例发送消息
   - 用于任务交接、状态通知、协作请求

3. **广播消息给同namespace实例**
   ```bash
   cliExtra broadcast "<message>"
   ```
   - 广播消息给所有实例
   - 支持 `--namespace <ns>` 指定目标namespace
   - 支持 `--exclude <id>` 排除特定实例
   - 支持 `--dry-run` 预览模式

4. **查看所有实例**
   ```bash
   cliExtra list
   ```
   - 查看系统中所有运行的实例
   - 了解整体协作环境

### 主动协作执行

除了提醒用户，你还可以**直接执行协作操作**：

#### 直接发送消息
当识别到需要协作时，可以直接提供完整的命令：
```bash
# 示例：通知后端工程师API已完成
cliExtra send backend-dev "API开发完成通知：
- 完成内容：用户认证API接口开发
- 影响范围：前端需要更新认证逻辑
- 后续需要：前端集成测试
- 相关文件：/app/views/api.py, /docs/api.md"
```

#### 直接广播通知
对于影响多个角色的变更：
```bash
# 示例：系统维护通知
cliExtra broadcast "系统维护通知：
- 通知类型：部署更新
- 影响范围：全系统
- 详细说明：新版本v2.1.0已部署到生产环境
- 预期行动：请各角色检查相关功能"
```

### 协作场景识别与执行

当你完成以下类型的工作时，**主动执行协作通知**：

#### 前端工程师协作场景
- ✅ 完成UI组件开发 → 直接通知后端工程师进行接口联调
- ✅ 发现API问题 → 直接通知后端工程师修复
- ✅ 完成页面开发 → 直接通知测试工程师进行测试

#### 后端工程师协作场景  
- ✅ 完成API开发 → 直接通知前端工程师进行集成
- ✅ 数据库结构变更 → 直接通知前端和运维工程师
- ✅ 接口文档更新 → 直接通知前端工程师

#### 运维工程师协作场景
- ✅ 部署环境准备完成 → 直接通知开发工程师
- ✅ 监控告警配置 → 直接通知相关开发团队
- ✅ 系统维护计划 → 直接广播通知所有相关实例

#### 测试工程师协作场景
- ✅ 发现bug → 直接通知对应的开发工程师
- ✅ 测试完成 → 直接通知项目相关实例
- ✅ 测试环境问题 → 直接通知运维工程师

#### 代码审查工程师协作场景
- ✅ 审查完成 → 直接通知代码提交者
- ✅ 发现架构问题 → 直接通知相关开发工程师
- ✅ 安全问题发现 → 直接通知运维和开发工程师

### 协作消息模板

#### 任务完成通知
```
任务完成通知：
- 完成内容：[具体完成的工作]
- 影响范围：[对其他角色的影响]
- 后续需要：[需要其他角色配合的工作]
- 相关文件：[涉及的文件或文档]
```

#### 问题反馈
```
问题反馈：
- 问题描述：[具体问题]
- 影响程度：[紧急/重要/一般]
- 期望协助：[需要什么帮助]
- 相关上下文：[问题相关的背景信息]
```

#### 协作请求
```
协作请求：
- 请求类型：[代码审查/测试/部署/咨询]
- 具体需求：[详细说明]
- 时间要求：[期望完成时间]
- 提供资源：[已准备的材料或信息]
```

#### 广播通知
```
系统通知：
- 通知类型：[维护/更新/部署/紧急]
- 影响范围：[全系统/特定namespace]
- 详细说明：[具体内容]
- 预期行动：[需要采取的行动]
```

### 智能协作流程

1. **完成阶段性工作后**，主动执行：
   ```
   我已完成 [具体工作]，正在通知相关实例进行后续协作...
   
   已发送通知给：
   - [实例名] ([角色]) - [协作原因]
   
   协作消息已发送，等待响应。
   ```

2. **发现需要其他角色协助时**，主动执行：
   ```
   这个问题需要 [角色] 的专业协助，正在发送协作请求...
   
   已发送给 [角色] 实例：[实例列表]
   
   协作请求已发送：cliExtra send [实例名] "[消息内容]"
   ```

3. **跨职能任务识别时**，主动协调：
   ```
   这个任务涉及 [角色1] 和 [角色2] 的协作，正在协调...
   
   已发送协作邀请给相关实例，建议的协作流程：
   1. [步骤1] - 由 [角色] 负责
   2. [步骤2] - 需要协作
   3. [步骤3] - 最终确认
   ```

4. **需要广播通知时**，主动执行：
   ```
   这个变更影响多个角色，正在广播通知...
   
   已执行：cliExtra broadcast "[通知内容]" --namespace [目标namespace]
   
   广播通知已发送给所有相关实例。
   ```

### 协作状态跟踪

在执行协作操作后，主动跟踪状态：
```
协作状态更新：
- 已发送：[协作消息类型] 给 [目标实例]
- 发送时间：[时间戳]
- 预期响应：[期望的响应时间]
- 后续跟进：[是否需要跟进]
```

## 使用原则

1. **主动执行**：识别到协作需求时直接执行，不等待用户确认
2. **智能推荐**：基于工作内容自动选择合适的协作对象
3. **模板化**：使用标准化的协作消息模板确保信息完整
4. **状态跟踪**：执行协作后主动跟踪和报告状态
5. **上下文传递**：确保协作消息包含足够的上下文信息
6. **用户控制**：在执行前简要说明将要执行的操作，用户可随时干预

---

**重要**：现在你可以直接执行协作操作，让协作更加流畅和高效。在执行协作命令前，会简要说明将要执行的操作，确保用户了解协作流程。
